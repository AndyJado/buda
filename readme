## 一种有限元网格装配方法

### 摘要

一种操作对象为有限元网格体的装配算法, 定义了有向无环的三元递归数据结构用以描述装配关系, 以便实现装配过程的自动化与局部模型更改到全局装配的自动更新. 


### 技术背景

近年来, 有限元求解器能够计算的场景复杂度随着芯片发展指数级增加, 然而, 有限元方法需要的现实场景网格化却大量依赖过程式的人工劳动, 这让有限元在应用层面, 随着生产力提高发展成了劳动密集型作业, 而这一趋势有增无减:

1. 专业前处理软件: 例如HYPERMESH,ANSA, 提供了先进的网格划分算法与几何处理工具, 为复杂CAD装配模型网格化提供`扳手`, 是当前业界的主流选择.
2. 无网格法: 例如Simsolid, 可以直接分析未网格化的CAD装配模型, 由于结构尺寸信息完整, 在模态分析如NVH具有优势, 在其他求解类型的计算准确性不足. 
3. 直接网格建模: 三维动画制作软件例如Blender, 直接使用网格体建模, 将两个劳动合并为一个, 建模的同时考虑网格质量. 不过CAD建模通常是工业设计的起点, 而直接网格建模的优势需要CAE仿真设计放在CAD直观设计之前才能体现, 此类工具通常用于解决某些特定领域问题, 比如复合材料铺层建模工具texgen.  

笔者所在团队开发了一些工具, 用于创建通用的三维网格结构, 接下来就遇到了网格模型的装配问题, 传统CAD装配逻辑不适用在于:

1. 面的选择:  可参考FreeCAD的A2plus插件(A: Assembly),一般装配工具的操作对象是三维模型的面和轮廓线. 而三维网格体仅存在节点的几何信息与单元的节点索引, 没有面和线可供选择.

2. 螺栓等连接件处理: 螺栓,轴承等连接件在有限元分析中有特定的抽象方式, 螺栓孔同样无需在建模阶段考虑.

3. 装配关系的数据结构: 在仿真设计阶段, 模型局部结构频繁更新, 如果更新需要自动体现到全局模型中, 那么模型间的装配关系需要有向无环的数据结构(direct acyclic graph), 避免循环依赖. 

因此, 一个服务于CAE仿真迭代设计的网格体装配算法是必要的.


### 说明    

- 情境: 在计算机系统中接收有限元分析(FEA)网格的模型集合, 模型集在全局坐标系下观测, 存在任意数量的模型位置不匹配.

-  基本方法: 装配行为表达为程序对模型集中所有主从坐标系的关系推演. 通过仿射变换, 从坐标系所在模型将被移动到另一个模型文件中的主坐标系, 程序将穷举所有装配可能性, 工程师可修正约束以调整潜在求解域, 或在结果中筛选. 

- 坐标系定义: 作为模型的固有本地属性, 坐标系可由相应模型上三   个节点顺序确定, 未定义主从坐标系的模型不会被程序索引. 

- 三元递归: 单个模型在同一索引深度下, 允许存在任意个数的主坐标系,仅允许存在一个从坐标系. 至多三个连接模型会在下一个深度被视为一个模型. 即, 进入下一深度时该模型若暴露出两个从坐标系, 则当前可能性不成立.

- 索引深度: 索引深度在程序中定义为一个双端队列(Deque). 索引深度图(Graph)与模型文件无关, 应能够纸上用点与双端线轻松绘出. 一对主从坐标系将在装配行为完成后停留在当前深度.

- 一个可能解: 沿索引深度递归, 直到剩余从坐标系个数为0, 该装配关系视为一个可能解. 此时, 主坐标系=1 && (中间从坐标系-中间主坐标系)<=1 && 从坐标系=1, 仿射变换具有唯一性.

- 可增加约束: 在定义主坐标系时可增加对从模型的约束, 包括但不限于模型id,类型,几何特征. 从而减小求解域.

- 可释放约束: 例如, 高曲率的稀疏面网格的局部坐标系难以准确选取, 在坐标系定义时增加误差限,从而增加潜在求解域.

- 解集的概率分布: 初筛可通过索引深度图对比, 此时不涉及任何模型移动操作, 关系推导不会造成计算瓶颈. 二筛可通过box体积干涉检测, 每个模型体积将变成由8个点描述, 按索引深度递归式计算相邻体积干涉.

- AI模型引入: 此装配方法有且仅有三个用户交互界面, 均能够直接接入AI模型的训练或推理过程.
    1). 对于单个模型的主从坐标系定义: 可接入嵌入小尺寸GAN(生成对抗网络)替代人工选点生成坐标系.
    2). 增加或释放约束: 可接入多模态语言模型利用其看图与reasoning调整相应约束.
    3). 从解集中筛选正确解: 将解集的概率分布权重作为loss function训练GAN模型.